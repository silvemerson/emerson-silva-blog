<!DOCTYPE html>
<html lang="pt-br">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP - Emerson Silva</title><meta name="Description" content="This is Emerson Silva"><meta property="og:url" content="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/">
  <meta property="og:site_name" content="Emerson Silva">
  <meta property="og:title" content="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP">
  <meta property="og:description" content="Olá pessoal, hoje no blog, vamos realizar um deploy na GCP com uma ferramenta em potencial de Infra as Code chamada OpenTofu, um fork do Terraform. Bora lá!
Antes de iniciar, vocês precisam ler isso Antes que possamos iniciar o passo a passo para provisionar uma VM na GCP usando o OpenTofu, você precisa ler o post anterior que fala sobre o que é, porque ela nasceu e sobre a licença BSL.">
  <meta property="og:locale" content="pt_br">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-19T12:24:03-03:00">
    <meta property="article:modified_time" content="2024-11-19T12:24:03-03:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Iac">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP">
  <meta name="twitter:description" content="Olá pessoal, hoje no blog, vamos realizar um deploy na GCP com uma ferramenta em potencial de Infra as Code chamada OpenTofu, um fork do Terraform. Bora lá!
Antes de iniciar, vocês precisam ler isso Antes que possamos iniciar o passo a passo para provisionar uma VM na GCP usando o OpenTofu, você precisa ler o post anterior que fala sobre o que é, porque ela nasceu e sobre a licença BSL.">
<meta name="application-name" content="Emerson Silva">
<meta name="apple-mobile-web-app-title" content="Emerson Silva"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" /><link rel="prev" href="http://localhost:1313/posts/glossario-cd/index.en/" /><link rel="next" href="http://localhost:1313/posts/trilha-cicd-gitlab-kaniko/index.en/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP",
        "inLanguage": "pt-br",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/posts\/desbravando-o-opentofu-primeira-parte2\/index.en\/"
        },"genre": "posts","keywords": "devops, iac","wordcount":  770 ,
        "url": "http:\/\/localhost:1313\/posts\/desbravando-o-opentofu-primeira-parte2\/index.en\/","datePublished": "2024-11-19T12:24:03-03:00","dateModified": "2024-11-19T12:24:03-03:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Emerson Silva"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Emerson Silva">Emerson Silva</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Emerson Silva">Emerson Silva</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Emerson Silva</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/iac/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>IaC</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-11-19">2024-11-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;770 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutos&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#antes-de-iniciar-vocês-precisam-ler-isso">Antes de iniciar, vocês precisam ler isso</a></li>
    <li><a href="#instalação-do-opentofu">Instalação do OpenTofu</a></li>
    <li><a href="#conecte-se-a-gcp">Conecte-se a GCP</a>
      <ul>
        <li><a href="#instalar-e-configurar-o-gcloud-cli">Instalar e Configurar o gcloud CLI</a></li>
      </ul>
    </li>
    <li><a href="#configure-o-provedor-gcp-no-providertf">Configure o Provedor GCP no provider.tf</a></li>
    <li><a href="#defina-variáveis-básicas-no-variablestf">Defina Variáveis Básicas no variables.tf</a></li>
    <li><a href="#crie-o-recurso-do-firewall">Crie o Recurso do Firewall</a></li>
    <li><a href="#crie-o-recurso-da-instância">Crie o Recurso da Instância</a></li>
    <li><a href="#adicione-um-arquivo-de-saída">Adicione um Arquivo de Saída</a></li>
    <li><a href="#construindo-o-ambiente">Construindo o ambiente</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Olá pessoal, hoje no blog, vamos realizar um deploy na GCP com uma ferramenta em potencial de Infra as Code chamada OpenTofu, um fork do Terraform. Bora lá!</p>
<h2 id="antes-de-iniciar-vocês-precisam-ler-isso">Antes de iniciar, vocês precisam ler isso</h2>
<p>Antes que possamos iniciar o passo a passo para provisionar uma VM na GCP usando o <a href="https://opentofu.org/" target="_blank" rel="noopener noreffer ">OpenTofu</a>, você precisa ler o post anterior que fala sobre o que é, porque ela nasceu e sobre a licença BSL.</p>
<p>Então leia <a href="https://emerson-silva.blog.br/posts/desbravando-o-opentofu-primeira-parte1/" target="_blank" rel="noopener noreffer ">Desbravando o OpenTofu: Parte 01 – Introdução e Fundamentos
</a></p>
<h2 id="instalação-do-opentofu">Instalação do OpenTofu</h2>
<p>Certifique-se de que o OpenTofu está instalado. Siga os passos abaixo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -s https://packagecloud.io/install/repositories/opentofu/tofu/script.deb.sh?any<span style="color:#f92672">=</span>true -o /tmp/tofu-repository-setup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo bash /tmp/tofu-repository-setup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rm /tmp/tofu-repository-setup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo apt-get install tofu
</span></span></code></pre></div><h2 id="conecte-se-a-gcp">Conecte-se a GCP</h2>
<h3 id="instalar-e-configurar-o-gcloud-cli">Instalar e Configurar o gcloud CLI</h3>
<p>Baixe e instale o SDK do Google Cloud em sua máquina seguindo as instruções de instalação do <a href="https://cloud.google.com/sdk/docs/install?hl=pt-br" target="_blank" rel="noopener noreffer ">SDK</a>.</p>
<ol>
<li><strong>Faça login na sua conta GCP</strong>:</li>
</ol>
<p>Depois de instalar o SDK, abra o terminal e execute:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth login
</span></span></code></pre></div><p>Isso abrirá uma página de autenticação no seu navegador. Após o login, seu terminal estará autenticado com sua conta do Google Cloud.</p>
<ol start="2">
<li><strong>Defina o projeto padrão</strong>:</li>
</ol>
<p>Para evitar a necessidade de especificar o projeto em cada comando, defina o projeto padrão. Substitua PROJECT_ID pelo ID do seu projeto na GCP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud config set project PROJECT_ID
</span></span></code></pre></div><p>Pronto, agora podemos configurar nossos arquivos para provisionar a VM na GCP.</p>
<h2 id="configure-o-provedor-gcp-no-providertf">Configure o Provedor GCP no provider.tf</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">terraform</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">required_providers</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">google</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">source</span>  <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;hashicorp/google&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">version</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#e6db74">&#34;~&gt; 4.0&#34;</span> <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">Ou</span> <span style="color:#960050;background-color:#1e0010">a</span> <span style="color:#960050;background-color:#1e0010">versão</span> <span style="color:#960050;background-color:#1e0010">mais</span> <span style="color:#960050;background-color:#1e0010">recente</span> <span style="color:#960050;background-color:#1e0010">suportada</span> <span style="color:#960050;background-color:#1e0010">pelo</span> <span style="color:#960050;background-color:#1e0010">OpenTofu</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">provider</span> <span style="color:#e6db74">&#34;google&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">project</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.project_id</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">region</span>  <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.region</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">zone</span>    <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.zone</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Nesse arquivo vamos configurar o provider da Google.</p>
<h2 id="defina-variáveis-básicas-no-variablestf">Defina Variáveis Básicas no variables.tf</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">variable</span> <span style="color:#e6db74">&#34;project_id&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">description</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;ID do projeto GCP&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">type</span>        <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">variable</span> <span style="color:#e6db74">&#34;region&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">default</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;us-central1&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">variable</span> <span style="color:#e6db74">&#34;zone&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">default</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;us-central1-a&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">variable</span> <span style="color:#e6db74">&#34;instance_name&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">default</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;opentofu-vm-instance&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">variable</span> <span style="color:#e6db74">&#34;machine_type&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">default</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;e2-micro&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Nesse arquivo pessoal, estamos configurando as váriaveis que serão defindas nos arquivos <code>provider.tf</code>, <code>vm.tf</code> e <code>fw.tf</code>.</p>
<h2 id="crie-o-recurso-do-firewall">Crie o Recurso do Firewall</h2>
<p>No <code>fw.tf</code>, defina a instância da VM e um firewall básico para permitir o acesso SSH.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">resource</span> <span style="color:#e6db74">&#34;google_compute_network&#34;</span> <span style="color:#e6db74">&#34;vpc_network&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">name</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;opentofu-network&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">resource</span> <span style="color:#e6db74">&#34;google_compute_firewall&#34;</span> <span style="color:#e6db74">&#34;allow_ssh&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">name</span>    <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;allow-ssh&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">network</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">google_compute_network.vpc_network.name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">allow</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">protocol</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;tcp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">ports</span>    <span style="color:#960050;background-color:#1e0010">=</span> [<span style="color:#e6db74">&#34;22&#34;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">source_ranges</span> <span style="color:#960050;background-color:#1e0010">=</span> [<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="crie-o-recurso-da-instância">Crie o Recurso da Instância</h2>
<p>Agora galera, crie um arquivo chamado <code>vm.tf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">resource</span> <span style="color:#e6db74">&#34;google_compute_instance&#34;</span> <span style="color:#e6db74">&#34;vm_instance&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">name</span>         <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.instance_name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">machine_type</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.machine_type</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">zone</span>         <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">var.zone</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">boot_disk</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">initialize_params</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">image</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;debian-cloud/debian-11&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">network_interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">network</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">google_compute_network.vpc_network.name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">access_config</span> <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">Para</span> <span style="color:#960050;background-color:#1e0010">criar</span> <span style="color:#960050;background-color:#1e0010">um</span> <span style="color:#960050;background-color:#1e0010">IP</span> <span style="color:#960050;background-color:#1e0010">público</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">metadata</span> <span style="color:#960050;background-color:#1e0010">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">ssh-keys</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;usuario_gcp:${file(&#34;</span><span style="color:#960050;background-color:#1e0010">~/.ssh/id_rsa.pub</span><span style="color:#e6db74">&#34;)}&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h2 id="adicione-um-arquivo-de-saída">Adicione um Arquivo de Saída</h2>
<p>Para facilitar a visualização do IP público da instância, você pode criar um arquivo <code>outputs.tf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">output</span> <span style="color:#e6db74">&#34;instance_ip&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">value</span>       <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#960050;background-color:#1e0010">google_compute_instance.vm_instance.network_interface[0].access_config[0].nat_ip</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">description</span> <span style="color:#960050;background-color:#1e0010">=</span> <span style="color:#f92672">&#34;Endereço IP público da instância GCP&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="construindo-o-ambiente">Construindo o ambiente</h2>
<p>Como vocês observaram, a forma de desenvolver a infra segue usando a linguagem HCL o que mude para o deploy é o binário de execução, ao invés de <code>terraform</code> vamos usar <code>tofu</code></p>
<p>Então execute em seu terminal os comandos abaixo.</p>
<p>Para inicializar o diretório e baixar os plugins necessários:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tofu init
</span></span></code></pre></div><p><strong>Mensagem</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Initializing the backend...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Initializing provider plugins...
</span></span><span style="display:flex;"><span>- Finding hashicorp/google versions matching <span style="color:#e6db74">&#34;~&gt; 4.0&#34;</span>...
</span></span><span style="display:flex;"><span>- Installing hashicorp/google v4.85.0...
</span></span><span style="display:flex;"><span>- Installed hashicorp/google v4.85.0 <span style="color:#f92672">(</span>signed, key ID 0C0AF313E5FD9F80<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Providers are signed by their developers.
</span></span><span style="display:flex;"><span>If you<span style="color:#960050;background-color:#1e0010">&#39;</span>d like to know more about provider signing, you can read about it here:
</span></span><span style="display:flex;"><span>https://opentofu.org/docs/cli/plugins/signing/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OpenTofu has created a lock file .terraform.lock.hcl to record the provider
</span></span><span style="display:flex;"><span>selections it made above. Include this file in your version control repository
</span></span><span style="display:flex;"><span>so that OpenTofu can guarantee to make the same selections by default when
</span></span><span style="display:flex;"><span>you run <span style="color:#e6db74">&#34;tofu init&#34;</span> in the future.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OpenTofu has been successfully initialized!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You may now begin working with OpenTofu. Try running <span style="color:#e6db74">&#34;tofu plan&#34;</span> to see
</span></span><span style="display:flex;"><span>any changes that are required <span style="color:#66d9ef">for</span> your infrastructure. All OpenTofu commands
</span></span><span style="display:flex;"><span>should now work.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If you ever set or change modules or backend configuration <span style="color:#66d9ef">for</span> OpenTofu,
</span></span><span style="display:flex;"><span>rerun this command to reinitialize your working directory. If you forget, other
</span></span><span style="display:flex;"><span>commands will detect it and remind you to <span style="color:#66d9ef">do</span> so <span style="color:#66d9ef">if</span> necessary.
</span></span></code></pre></div><p>Observe as referências do OpenTofu. Siga com os demais comandos.</p>
<p>Planejando a criação da infra:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tofu plan
</span></span></code></pre></div><p>Criando a Infraestrutura:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tofu apply
</span></span></code></pre></div><p>Pronto pessoal, feito o deploy de uma VM na GCP usando o OpenTofu!!!</p>
<p>Caso queria deletar a infra execute <code>tofu destroy</code></p>
<p>Por hoje é só pessoal, em breve voltamos com mais.
Não esqueçam de compartilhar esse post em suas redes sociais</p>
<p>Abraço</p>
<h1 id="repositório-do-exemplo">Repositório do exemplo</h1>
<p><a href="https://github.com/silvemerson/gcp-vm-infra-opentofu-example" target="_blank" rel="noopener noreffer ">https://github.com/silvemerson/gcp-vm-infra-opentofu-example</a></p>
<h1 id="referências">Referências</h1>
<p><a href="https://opentofu.org/" target="_blank" rel="noopener noreffer ">https://opentofu.org/</a></p>
<p><a href="https://opentofu.org/docs/intro/install/" target="_blank" rel="noopener noreffer ">https://opentofu.org/docs/intro/install/</a></p>
<p><a href="https://opentofu.org/docs/intro/" target="_blank" rel="noopener noreffer ">https://opentofu.org/docs/intro/</a></p>
<p><a href="https://www.linuxfoundation.org/press/announcing-opentofu" target="_blank" rel="noopener noreffer ">https://www.linuxfoundation.org/press/announcing-opentofu</a></p>
<p><a href="https://emerson-silva.blog.br/posts/desbravando-o-opentofu-primeira-parte1/" target="_blank" rel="noopener noreffer ">https://emerson-silva.blog.br/posts/desbravando-o-opentofu-primeira-parte1/</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2024-11-19</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em Twitter" data-sharer="twitter" data-url="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" data-title="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP" data-hashtags="devops,iac"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" data-hashtag="devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" data-title="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" data-title="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="http://localhost:1313/posts/desbravando-o-opentofu-primeira-parte2/index.en/" data-title="Desbravando o OpenTofu: Parte 02 – Provisionando uma VM na GCP"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/iac/">Iac</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/glossario-cd/index.en/" class="prev" rel="prev" title="004 - Glossário Tech - o que é Continuous Delivery/Deployment"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>004 - Glossário Tech - o que é Continuous Delivery/Deployment</a>
            <a href="/posts/trilha-cicd-gitlab-kaniko/index.en/" class="next" rel="next" title="Trilha CI/CD - Gitlab-CI - Build de imagens de contêineres com Kaniko">Trilha CI/CD - Gitlab-CI - Build de imagens de contêineres com Kaniko<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.139.2">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar para a área de transferência","maxShownLines":50},"comment":{},"lightgallery":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
